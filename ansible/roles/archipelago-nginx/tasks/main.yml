- name: install nginx
  apt: pkg=nginx state=installed

- name: configure nginx sites as available
  template: src={{item}} dest=/etc/nginx/sites-available/{{ item | basename }}
  with_fileglob:
   - templates/vhosts/*
  notify:
   - restart nginx

- name: Configure nginx sites as enabled
  file: path=/etc/nginx/sites-enabled/{{ item | basename }} src=../sites-available/{{ item | basename }} state=link
  with_fileglob:
   - templates/vhosts/*
  notify:
   - restart nginx

- name: configure nginx error pages
  template: src={{item}} dest=/var/www/errors/{{ item | basename }}
  with_fileglob:
   - templates/errors/*

- name: configure nginx base page
  template: src=host_not_found.html dest=/var/www/html/index.html

- name: configure nginx error pages
  template: src=config/errors.conf dest=/etc/nginx/snippets/errors.conf
  notify:
   - restart nginx
